import{k as u,o as x,x as I,a as l,h as c,b as a,t as r,l as R,f as C,y as A,F as w,r as y,n as _,g as G,s as d}from"./index-y_s3za8l.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"health-check"},U={class:"header"},H={class:"controls"},W=["disabled"],B={class:"auto-refresh"},D={class:"section"},K={class:"service-grid"},P={class:"service-name"},M={class:"service-status"},V={class:"section"},q=["disabled"],F={class:"test-grid"},L={class:"test-details"},$={class:"test-name"},Q={key:0,class:"test-output"},z={class:"section"},J={class:"log-viewer"},X={__name:"HealthCheck",setup(Y){const m=u(!1),g=u(!1),h=u(!1),v=u(""),N=u([{name:"Echo Brain",port:8309,status:"unknown",statusText:"CHECKING"},{name:"Anime Production",port:8328,status:"unknown",statusText:"CHECKING"},{name:"ComfyUI",port:8188,status:"unknown",statusText:"CHECKING"},{name:"Ollama",port:11434,status:"unknown",statusText:"CHECKING"},{name:"Qdrant",port:6333,status:"unknown",statusText:"CHECKING"},{name:"Redis",port:6379,status:"unknown",statusText:"CHECKING"}]),p=u([{name:"Model Routing",status:"pending",icon:"○",result:"Not tested",output:""},{name:"Context Contamination",status:"pending",icon:"○",result:"Not tested",output:""},{name:"Theater Integration",status:"pending",icon:"○",result:"Not tested",output:""},{name:"WebSocket Connection",status:"pending",icon:"○",result:"Not tested",output:""}]);let f=null;async function b(e){try{const s={"Echo Brain":"https://vestal-garcia.duckdns.org/api/coordination/services","Anime Production":"https://vestal-garcia.duckdns.org/api/anime/health",ComfyUI:"https://vestal-garcia.duckdns.org/api/comfyui/system_stats",Ollama:"https://vestal-garcia.duckdns.org/api/ollama/tags",Qdrant:"https://vestal-garcia.duckdns.org/api/qdrant/collections",Redis:null};if(e.name==="Redis"){const t=await d.get("https://vestal-garcia.duckdns.org/api/echo/db/stats",{timeout:2e3});e.status=t.data.redis_connected?"running":"stopped",e.statusText=t.data.redis_connected?"RUNNING":"NOT CONNECTED"}else{const t=s[e.name];await d.get(t,{timeout:2e3}),e.status="running",e.statusText="RUNNING"}}catch(s){e.status="stopped",e.statusText=s.code==="ECONNREFUSED"?"NOT RUNNING":"ERROR"}}async function k(){m.value=!0,await Promise.all(N.value.map(b));try{const e=await d.post("https://vestal-garcia.duckdns.org/api/echo/admin/logs",{lines:20});v.value=e.data.logs||"Unable to fetch logs"}catch(e){v.value=`Error fetching logs: ${e.message}`}m.value=!1}async function E(){g.value=!0;const e=p.value[0];e.status="testing",e.icon="⟳";try{const n=await d.post("https://vestal-garcia.duckdns.org/api/echo/chat",{query:"What model are you using? Just return the model name.",temperature:0},{timeout:3e4}),i=n.data.response||n.data.message||"";i.includes("deepseek-coder-v2")||i.includes("deepseek-r1")?(e.status="passed",e.icon="✓",e.result=`Model: ${i.match(/deepseek-[^\s]+/)[0]}`):(e.status="failed",e.icon="✗",e.result="Wrong model selected",e.output=i)}catch(n){e.status="failed",e.icon="✗",e.result="API Error",e.output=n.message}const s=p.value[1];s.status="testing",s.icon="⟳";try{const n=await d.post("https://vestal-garcia.duckdns.org/api/echo/chat",{query:'Return exactly: {"test": 1}',temperature:0},{timeout:3e4}),i=n.data.response||n.data.message||"";i.trim()==='{"test": 1}'?(s.status="passed",s.icon="✓",s.result="CLEAN - No contamination"):(s.status="failed",s.icon="✗",s.result="CONTAMINATED - Got narrative wrapper",s.output=i.substring(0,200))}catch(n){s.status="failed",s.icon="✗",s.result="API Error",s.output=n.message}const t=p.value[2];t.status="testing",t.icon="⟳";try{const n=await d.get("https://vestal-garcia.duckdns.org/api/theater/agents",{timeout:5e3});n.data&&Array.isArray(n.data.agents)?(t.status="passed",t.icon="✓",t.result=`${n.data.agents.length} agents registered`):(t.status="warning",t.icon="⚠",t.result="Theater endpoint exists but no agents")}catch{t.status="failed",t.icon="✗",t.result="NOT INTEGRATED",t.output="Theater files not wired up"}const o=p.value[3];o.status="testing",o.icon="⟳";try{const n=new WebSocket("wss://vestal-garcia.duckdns.org/echo-brain/ws/echo");await new Promise((i,T)=>{n.onopen=()=>{o.status="passed",o.icon="✓",o.result="WebSocket connected",n.close(),i()},n.onerror=()=>{o.status="failed",o.icon="✗",o.result="WebSocket connection failed",T()},setTimeout(()=>T(new Error("Timeout")),3e3)})}catch{o.status="failed",o.icon="✗",o.result="WebSocket not available"}g.value=!1}return x(()=>{k(),f=setInterval(()=>{h.value&&k()},5e3)}),I(()=>{f&&clearInterval(f)}),(e,s)=>(c(),l("div",O,[a("div",U,[s[2]||(s[2]=a("h1",null,"ECHO BRAIN STATUS",-1)),a("div",H,[a("button",{onClick:k,disabled:m.value,class:"btn-refresh"},r(m.value?"Checking...":"Refresh"),9,W),a("label",B,[R(a("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=t=>h.value=t)},null,512),[[A,h.value]]),s[1]||(s[1]=C(" Auto (5s) ",-1))])])]),a("div",D,[s[3]||(s[3]=a("h2",null,"Services",-1)),a("div",K,[(c(!0),l(w,null,y(N.value,t=>(c(),l("div",{key:t.name,class:"service-item"},[a("span",{class:_(["status-indicator",t.status])},null,2),a("span",P,r(t.name)+" ("+r(t.port)+")",1),a("span",M,r(t.statusText),1)]))),128))])]),a("div",V,[a("h2",null,[s[4]||(s[4]=C("Verification Tests ",-1)),a("button",{onClick:E,disabled:g.value,class:"btn-small"},"Run All",8,q)]),a("div",F,[(c(!0),l(w,null,y(p.value,t=>(c(),l("div",{key:t.name,class:"test-item"},[a("span",{class:_(["test-status",t.status])},r(t.icon),3),a("div",L,[a("div",$,r(t.name),1),a("div",{class:_(["test-result",t.status])},r(t.result),3),t.output?(c(),l("pre",Q,r(t.output),1)):G("",!0)])]))),128))])]),a("div",z,[s[5]||(s[5]=a("h2",null,"Recent Logs",-1)),a("div",J,[a("pre",null,r(v.value),1)])])]))}},tt=S(X,[["__scopeId","data-v-9eb911ed"]]);export{tt as default};
